<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Управление ботом - Панель администратора</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background-color: #343a40;
            color: white;
            transition: all 0.3s;
        }
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-left: 3px solid transparent;
            padding: 0.75rem 1rem;
        }
        .sidebar .nav-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 3px solid #0d6efd;
        }
        .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 3px solid #0d6efd;
        }
        .submenu {
            padding-left: 1.5rem;
            background-color: rgba(0, 0, 0, 0.1);
            display: none;
        }
        .submenu.show {
            display: block;
        }
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-x: auto;
        }
        .sidebar-header {
            padding: 1rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-title {
            font-size: 1.1rem;
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            font-weight: bold;
            border-bottom: 3px solid #0d6efd;
        }
        .tab-content {
            padding: 20px 0;
        }
    </style>
</head>
<body>
    <!-- Левая панель навигации -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h5>Панель администратора</h5>
        </div>
        <nav class="navbar-nav">
            <a class="nav-link" href="/admin/dashboard">
                <i class="bi bi-speedometer2 me-2"></i>Главная
            </a>
            <a class="nav-link" href="/admin/bot-management">
                <i class="bi bi-robot me-2"></i>Управление ботом
            </a>
            <a class="nav-link" href="#">
                <i class="bi bi-cash-coin me-2"></i>Бухгалтерия
            </a>
            <a class="nav-link" href="/admin/users">
                <i class="bi bi-people me-2"></i>Пользователи
            </a>
            <a class="nav-link" href="/admin/orders">
                <i class="bi bi-cart me-2"></i>Заказы
            </a>
            <a class="nav-link" href="/admin/transactions">
                <i class="bi bi-credit-card me-2"></i>Транзакции
            </a>
            <a class="nav-link" href="#">
                <i class="bi bi-gear me-2"></i>Настройки
            </a>
            <a class="nav-link" href="/admin/logout">
                <i class="bi bi-box-arrow-right me-2"></i>Выход
            </a>
        </nav>
    </div>

    <!-- Основной контент -->
    <div class="main-content">
        <div class="container-fluid">
            <h1>Управление ботом</h1>
            
            <!-- Навигационные вкладки -->
            <ul class="nav nav-tabs" id="botManagementTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="texts-tab" data-bs-toggle="tab" data-bs-target="#texts" type="button" role="tab" aria-controls="texts" aria-selected="true">
                        <i class="bi bi-chat-text me-1"></i> Тексты
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cities-tab" data-bs-toggle="tab" data-bs-target="#cities" type="button" role="tab" aria-controls="cities" aria-selected="false">
                        <i class="bi bi-building me-1"></i> Города
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="districts-tab" data-bs-toggle="tab" data-bs-target="#districts" type="button" role="tab" aria-controls="districts" aria-selected="false">
                        <i class="bi bi-geo-alt me-1"></i> Районы
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button" role="tab" aria-controls="products" aria-selected="false">
                        <i class="bi bi-box me-1"></i> Товары
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="delivery-tab" data-bs-toggle="tab" data-bs-target="#delivery" type="button" role="tab" aria-controls="delivery" aria-selected="false">
                        <i class="bi bi-truck me-1"></i> Доставка
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="links-tab" data-bs-toggle="tab" data-bs-target="#links" type="button" role="tab" aria-controls="links" aria-selected="false">
                        <i class="bi bi-link me-1"></i> Ссылки
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="images-tab" data-bs-toggle="tab" data-bs-target="#images" type="button" role="tab" aria-controls="images" aria-selected="false">
                        <i class="bi bi-image me-1"></i> Изображения
                    </button>
                </li>
            </ul>
            
            <!-- Содержимое вкладок -->
            <div class="tab-content" id="botManagementContent">
                <!-- Вкладка текстов -->
                <div class="tab-pane fade show active" id="texts" role="tabpanel" aria-labelledby="texts-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Добавить новый текст</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" action="/admin/bot/texts/add">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">Язык</label>
                                            <select name="lang" class="form-select" required>
                                                {% for lang in languages %}
                                                <option value="{{ lang }}">{{ lang }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">Ключ</label>
                                            <input type="text" name="key" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Значение</label>
                                            <input type="text" name="value" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <button type="submit" class="btn btn-success w-100">Добавить</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Все тексты</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Язык</th>
                                            <th>Ключ</th>
                                            <th>Значение</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for text in texts %}
                                        <tr>
                                            <td>{{ text.id }}</td>
                                            <td>{{ text.lang }}</td>
                                            <td>{{ text.key }}</td>
                                            <td>
                                                <form method="post" action="/admin/bot/texts/update">
                                                    <input type="hidden" name="id" value="{{ text.id }}">
                                                    <div class="input-group">
                                                        <input type="text" name="value" value="{{ text.value }}" class="form-control">
                                                        <button type="submit" class="btn btn-primary">Сохранить</button>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <form method="post" action="/admin/bot/texts/delete/{{ text.id }}">
                                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Удалить этот текст?')">Удалить</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка городов -->
                <div class="tab-pane fade" id="cities" role="tabpanel" aria-labelledby="cities-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Добавить новый город</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" action="/admin/bot/cities/add">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label class="form-label">Название города</label>
                                            <input type="text" name="name" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <button type="submit" class="btn btn-success w-100">Добавить</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Все города</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Название</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for city in cities %}
                                        <tr>
                                            <td>{{ city.id }}</td>
                                            <td>
                                                <form method="post" action="/admin/bot/cities/update">
                                                    <input type="hidden" name="id" value="{{ city.id }}">
                                                    <div class="input-group">
                                                        <input type="text" name="name" value="{{ city.name }}" class="form-control">
                                                        <button type="submit" class="btn btn-primary">Сохранить</button>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <form method="post" action="/admin/bot/cities/delete/{{ city.id }}">
                                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Удалить этот город? Все связанные районы и товары также будут удалены.')">Удалить</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка районов -->
                <div class="tab-pane fade" id="districts" role="tabpanel" aria-labelledby="districts-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Добавить новый район</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" action="/admin/bot/districts/add">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Город</label>
                                            <select name="city_id" class="form-select" required>
                                                {% for city in cities %}
                                                <option value="{{ city.id }}">{{ city.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Название района</label>
                                            <input type="text" name="name" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <button type="submit" class="btn btn-success w-100">Добавить</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Все районы</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Город</th>
                                            <th>Район</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for district in districts %}
                                        <tr>
                                            <td>{{ district.id }}</td>
                                            <td>{{ district.city_name }}</td>
                                            <td>
                                                <form method="post" action="/admin/bot/districts/update">
                                                    <input type="hidden" name="id" value="{{ district.id }}">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <select name="city_id" class="form-select" required>
                                                                {% for city in cities %}
                                                                <option value="{{ city.id }}" {% if city.id == district.city_id %}selected{% endif %}>{{ city.name }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="input-group">
                                                                <input type="text" name="name" value="{{ district.name }}" class="form-control">
                                                                <button type="submit" class="btn btn-primary">Сохранить</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <form method="post" action="/admin/bot/districts/delete/{{ district.id }}">
                                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Удалить этот район?')">Удалить</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка товаров -->
                <div class="tab-pane fade" id="products" role="tabpanel" aria-labelledby="products-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Добавить новый товар</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" action="/admin/bot/products/add">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">Город</label>
                                            <select name="city_id" class="form-select" required>
                                                {% for city in cities %}
                                                <option value="{{ city.id }}">{{ city.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <label class="form-label">Название</label>
                                            <input type="text" name="name" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <label class="form-label">Цена ($)</label>
                                            <input type="number" step="0.01" name="price" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">URL изображения</label>
                                            <input type="text" name="image_url" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <button type="submit" class="btn btn-success w-100">Добавить</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Все товары</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Город</th>
                                            <th>Название</th>
                                            <th>Цена</th>
                                            <th>Изображение</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for product in products %}
                                        <tr>
                                            <td>{{ product.id }}</td>
                                            <td>{{ product.city_name }}</td>
                                            <td>
                                                <form method="post" action="/admin/bot/products/update">
                                                    <input type="hidden" name="id" value="{{ product.id }}">
                                                    <div class="row">
                                                        <div class="col-md-12 mb-2">
                                                            <select name="city_id" class="form-select" required>
                                                                {% for city in cities %}
                                                                <option value="{{ city.id }}" {% if city.id == product.city_id %}selected{% endif %}>{{ city.name }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                        <div class="col-md-12">
                                                            <div class="input-group">
                                                                <input type="text" name="name" value="{{ product.name }}" class="form-control">
                                                                <button type="submit" class="btn btn-primary">Сохранить</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <form method="post" action="/admin/bot/products/update">
                                                    <input type="hidden" name="id" value="{{ product.id }}">
                                                    <div class="input-group">
                                                        <span class="input-group-text">$</span>
                                                        <input type="number" step="0.01" name="price" value="{{ product.price }}" class="form-control">
                                                        <button type="submit" class="btn btn-primary">Сохранить</button>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <form method="post" action="/admin/bot/products/update">
                                                    <input type="hidden" name="id" value="{{ product.id }}">
                                                    <div class="input-group">
                                                        <input type="text" name="image_url" value="{{ product.image_url or '' }}" class="form-control">
                                                        <button type="submit" class="btn btn-primary">Сохранить</button>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <form method="post" action="/admin/bot/products/delete/{{ product.id }}">
                                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Удалить этот товар?')">Удалить</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Вкладка доставки -->
                <div class="tab-pane fade" id="delivery" role="tabpanel" aria-labelledby="delivery-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Добавить новый тип доставки</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" action="/admin/bot/delivery-types/add">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-3">
                                            <label class="form-label">Название типа доставки</label>
                                            <input type="text" name="name" class="form-control" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <button type="submit" class="btn btn-success w-100">Добавить</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Все типы доставки</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Название</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for type in delivery_types %}
                                        <tr>
                                            <td>{{ type.id }}</td>
                                            <td>
                                                <form method="post" action="/admin/bot/delivery-types/update">
                                                    <input type="hidden" name="id" value="{{ type.id }}">
                                                    <div class="input-group">
                                                        <input type="text" name="name" value="{{ type.name }}" class="form-control">
                                                        <button type="submit" class="btn btn-primary">Сохранить</button>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <form method="post" action="/admin/bot/delivery-types/delete/{{ type.id }}">
                                                    <button type="submit" class="btn btn-danger" onclick="return confirm('Удалить этот тип доставки?')">Удалить</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Вкладка ссылок -->
                <div class="tab-pane fade" id="links" role="tabpanel" aria-labelledby="links-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Управление ссылками</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" action="/admin/bot/settings/update">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Ссылка на оператора</label>
                                            <input type="text" name="operator_link" value="{{ bot_settings.get('operator_link', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ссылка на техподдержку</label>
                                            <input type="text" name="support_link" value="{{ bot_settings.get('support_link', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ссылка на правила</label>
                                            <input type="text" name="rules_link" value="{{ bot_settings.get('rules_link', '') }}" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Ссылка на канал</label>
                                            <input type="text" name="channel_link" value="{{ bot_settings.get('channel_link', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ссылка на отзывы</label>
                                            <input type="text" name="reviews_link" value="{{ bot_settings.get('reviews_link', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Ссылка на сайт</label>
                                            <input type="text" name="website_link" value="{{ bot_settings.get('website_link', '') }}" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Сохранить все ссылки</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Вкладка изображений -->
                <div class="tab-pane fade" id="images" role="tabpanel" aria-labelledby="images-tab">
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5>Управление изображениями меню</h5>
                        </div>
                        <div class="card-body">
                            <form method="post" action="/admin/bot/settings/update">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Главное меню</label>
                                            <input type="text" name="main_menu_image" value="{{ bot_settings.get('main_menu_image', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Меню баланса</label>
                                            <input type="text" name="balance_menu_image" value="{{ bot_settings.get('balance_menu_image', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Меню категорий</label>
                                            <input type="text" name="category_menu_image" value="{{ bot_settings.get('category_menu_image', '') }}" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Меню районов</label>
                                            <input type="text" name="district_menu_image" value="{{ bot_settings.get('district_menu_image', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Меню доставки</label>
                                            <input type="text" name="delivery_menu_image" value="{{ bot_settings.get('delivery_menu_image', '') }}" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Меню подтверждения</label>
                                            <input type="text" name="confirmation_menu_image" value="{{ bot_settings.get('confirmation_menu_image', '') }}" class="form-control">
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Сохранить все изображения</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Активируем соответствующую вкладку при загрузке страницы с якорем
        document.addEventListener('DOMContentLoaded', function() {
            const url = window.location.href;
            if (url.includes('#')) {
                const hash = url.split('#')[1];
                const tabTrigger = document.querySelector(`button[data-bs-target="#${hash}"]`);
                if (tabTrigger) {
                    new bootstrap.Tab(tabTrigger).show();
                }
            }
            
            // Обработка раскрытия/скрытия подменю товаров
            document.getElementById('productMenu').addEventListener('click', function(e) {
                e.preventDefault();
                const submenu = document.getElementById('productSubmenu');
                submenu.classList.toggle('show');
                
                // Поворот стрелки
                const icon = this.querySelector('.bi-chevron-down');
                icon.classList.toggle('bi-chevron-down');
                icon.classList.toggle('bi-chevron-up');
            });
        });
    </script>
</body>
    </html>
